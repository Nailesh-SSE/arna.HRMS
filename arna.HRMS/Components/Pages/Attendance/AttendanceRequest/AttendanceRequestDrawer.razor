@using arna.HRMS.Components.lib.components.ui.Forms

@if (isVisible)
{
    <!-- Drawer -->
    <div class="drawer d-flex flex-column @(isClosing ? "drawer-closing" : "drawer-open")">
        <!-- Header -->
        <div class="d-flex align-items-center justify-content-between border-bottom px-4 py-3">
            <h5 class="mb-0 fw-semibold">@Title</h5>

            <AppButton Text="X"
                       ButtonClass="btn btn-danger"
                       OnClick="CloseDrawer" />
        </div>
        <!-- Body -->
        <div class="drawer-body flex-grow-1 overflow-auto p-3">
            <div>
                <AppSelect Label="Reason*" Placeholder="Select Reason" />
            </div>
            <div class="d-flex justify-content-between align-items-center mt-5 mb-5">
                <AppDatePicker Label="From Date"/>

                <AppDatePicker Label="To Date"/>
            </div>
            <div class="mb-3">
                <AppSelect Label="Reason*" Placeholder="Select Reason" />
            </div>

            <!-- Overnight Checkout -->
            <div class="form-check mb-4">
                <input class="form-check-input" type="checkbox" id="overnightCheckout">
                <label class="form-check-label" for="overnightCheckout">
                    Is Clockout time after 00:00 midnight on next date
                </label>
            </div>

            <!-- Clock In / Clock Out -->
            <div class="row mb-4">
                <div class="col-6">
                    <AppInput Label="Clockin Time" Type="time" />
                </div>

                <div class="col-6">
                    <AppInput Label="Clockin Out" Type="time" />
                </div>
            </div>

            <!-- Break Duration -->
            <div class="mb-4">
                <AppInput Label="Clockin Time" Type="time" />
            </div>

            <!-- Work Duration -->
            <div class="row mb-4">
                <div class="col-6">
                    <AppInput Label="Total Work Duration" Type="text" value="09:00:00"/>
                </div>

                <div class="col-6">
                    <AppInput Label="Final Work Duration" Type="text"  />
                </div>
            </div>

            <!-- Message -->
            <div class="mb-4">
                <label class="form-label fw-semibold">Message <span class="text-danger">*</span></label>
                <textarea class="form-control" rows="3" placeholder="Enter message"></textarea>
            </div>

            <!-- Footer Buttons -->
            <div class="d-flex justify-content-end gap-2 border-top pt-3">
                <AppButton Text="Submit" ButtonClass="btn btn-secondary" />
                <AppButton Text="Cancel" ButtonClass="btn btn-dark" />
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback<bool> IsOpenChanged { get; set; }

    [Parameter] public string Title { get; set; } = "Drawer";
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private bool isVisible;
    private bool isClosing;

    protected override void OnParametersSet()
    {
        if (IsOpen)
        {
            isVisible = true;
            isClosing = false;
        }
    }

    private async Task CloseDrawer()
    {
        isClosing = true;

        // Wait for CSS animation to finish
        await Task.Delay(250);

        isVisible = false;
        isClosing = false;

        await IsOpenChanged.InvokeAsync(false);
    }
}
