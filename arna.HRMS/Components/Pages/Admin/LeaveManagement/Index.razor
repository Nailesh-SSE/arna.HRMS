@page "/admin-leave-management"

@using arna.HRMS.ClientServices.Auth
@using arna.HRMS.Components.Loader
@using arna.HRMS.Components.Pages.Admin.LeaveManagement
@using arna.HRMS.Core.Entities

@inherits AuthenticatedLayoutBase

<FullPageLoader Visible="isLoading" />

@if (!isLoading)
{
    <div class="container-fluid px-3 px-md-4 py-3 leave-fade-in">

        <!-- ══════════ HEADER ══════════ -->
        <div class="d-flex align-items-center justify-content-between mb-4">
            <div>
                <h3 class="fw-bold mb-1">
                    <i class="bi bi-briefcase-fill text-primary me-2"></i>
                    Leave Management
                </h3>
                <p class="text-muted mb-0">
                    Manage leave types, employee requests & festival holidays
                </p>
            </div>
        </div>

        <!-- ══════════ TAB NAVIGATION ══════════ -->
        <div class="card border-0 shadow-sm rounded-3 mb-4">
            <div class="card-body p-0">
                <ul class="nav nav-tabs leave-tabs px-3 pt-3" role="tablist">

                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == Tab.LeaveTypes ? "active" : "")"
                                @onclick="() => SetTab(Tab.LeaveTypes)">
                            <i class="bi bi-bookmark-check me-2"></i>
                            Leave Types
                            @if (leaveTypeCount > 0)
                            {
                                <span class="badge bg-primary bg-opacity-10 text-primary
                                             rounded-pill ms-2">
                                    @leaveTypeCount
                                </span>
                            }
                        </button>
                    </li>

                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == Tab.Requests ? "active" : "")"
                                @onclick="() => SetTab(Tab.Requests)">
                            <i class="bi bi-inbox me-2"></i>
                            Leave Requests
                            @if (pendingRequestCount > 0)
                            {
                                <span class="badge bg-warning text-dark
                                             rounded-pill ms-2">
                                    @pendingRequestCount
                                </span>
                            }
                        </button>
                    </li>

                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == Tab.Festivals ? "active" : "")"
                                @onclick="() => SetTab(Tab.Festivals)">
                            <i class="bi bi-calendar-heart me-2"></i>
                            Festival Holidays
                            @if (festivalCount > 0)
                            {
                                <span class="badge bg-success bg-opacity-10 text-success
                                             rounded-pill ms-2">
                                    @festivalCount
                                </span>
                            }
                        </button>
                    </li>

                </ul>
            </div>
        </div>

        <!-- ══════════ TAB CONTENT ══════════ -->
        <div class="tab-content">

            @if (activeTab == Tab.LeaveTypes)
            {
                <LeaveTypes @ref="leaveType"
                              OnCountChanged="c => { leaveTypeCount = c; StateHasChanged(); }" />
            }

            @if (activeTab == Tab.Requests)
            {
                <LeaveRequest @ref="leaveRequest"
                                 OnPendingCountChanged="c => { pendingRequestCount = c; StateHasChanged(); }" />
            }

            @if (activeTab == Tab.Festivals)
            {
                <FestivalHolidayType @ref="festivalHoliday"
                                    OnCountChanged="c => { festivalCount = c; StateHasChanged(); }" />
            }

        </div>

    </div>
}

@code {

    private bool isLoading = true;

    private enum Tab { LeaveTypes, Requests, Festivals }
    private Tab activeTab = Tab.LeaveTypes;

    // ── Badge counts ──
    private int leaveTypeCount;
    private int pendingRequestCount;
    private int festivalCount;

    // ── Tab refs ──
    private LeaveTypes? leaveType;
    private LeaveRequest? leaveRequest;
    private FestivalHolidayType? festivalHoliday;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        isLoading = false;
    }

    private void SetTab(Tab tab)
    {
        activeTab = tab;
    }
}