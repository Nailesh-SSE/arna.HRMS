<div class="picker-wrapper">

    <div class="picker-card" @onclick="Toggle">
        <div class="picker-value">
            @DisplayText
            <span class="calendar-icon">📅</span>
        </div>
    </div>

    @if (IsOpen)
    {
        <div class="picker-overlay" @onclick="Close"></div>

        <div class="picker-popup" @onclick:stopPropagation="true">

            <div class="calendar-grid">
                @foreach (var day in DaysInMonth)
                {
                    var fullDate = new DateTime(Year, Month, day);

                    <button type="button"
                            class="day-btn @(SelectedDate?.Date == fullDate ? "active" : "")"
                            @onclick="() => SelectDay(day)">
                        @day
                    </button>
                }
            </div>

        </div>
    }
</div>

@code {

    [Parameter] public int Year { get; set; }
    [Parameter] public int Month { get; set; }
    [Parameter] public DateTime? SelectedDate { get; set; }
    [Parameter] public EventCallback<DateTime?> DateChanged { get; set; }

    private bool IsOpen;

    private List<int> DaysInMonth =>
        Enumerable.Range(1, DateTime.DaysInMonth(Year, Month)).ToList();

    private string DisplayText =>
        SelectedDate.HasValue
            ? SelectedDate.Value.ToString("dd MMM yyyy")
            : "Select date";

    private void Toggle() => IsOpen = !IsOpen;

    private async Task SelectDay(int day)
    {
        var date = new DateTime(Year, Month, day);

        SelectedDate = date;
        IsOpen = false;

        await DateChanged.InvokeAsync(date);
    }

    private void Close() => IsOpen = false;
}
