@page "/emp-leave-management"

@using arna.HRMS.Components.Loader
@using arna.HRMS.Components.Pages.Admin.LeaveManagement
@using arna.HRMS.Components.lib.components.ui.Model
@using arna.HRMS.Models.ViewModels.Leave
@using arna.HRMS.Models.Dropdown
@using arna.HRMS.Models.Enums
@using arna.HRMS.Services
@using arna.HRMS.Services.Auth
@using arna.HRMS.Services.Common

@inject ILeaveService LeaveService
@inject NotificationService NotificationService
@inject IJSRuntime JsRuntime
@inherits AuthenticatedLayoutBase

<Loader Visible="isLoading" Message="@loadingMessage" />

@if (!isLoading)
{
    <div class="container-fluid px-3 px-md-4 py-3 leave-fade-in">

        <!-- ══════════ HEADER ══════════ -->
        <div class="d-flex align-items-center justify-content-between mb-4">
            <div>
                <h3 class="fw-bold mb-1">
                    <i class="bi bi-calendar2-check-fill text-primary me-2"></i>
                    Leave Management 
                </h3>
                <p class="text-muted mb-0">
                    Apply for leaves, track your balance & view festival holidays
                </p>
            </div>
        </div>

        <!-- ══════════ TAB NAVIGATION ══════════ -->
        <div class="card border-0 shadow-sm rounded-3 mb-4">
            <div class="card-body p-0">
                <ul class="nav nav-tabs leave-tabs px-3 pt-3" role="tablist">

                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == Tab.Leaves ? "active" : "")"
                                @onclick="() => SetTab(Tab.Leaves)">
                            <i class="bi bi-bookmark-check me-2"></i>
                            Leaves Types
                            @if (leaveRequestCount > 0)
                            {
                                <span class="badge bg-primary bg-opacity-10 text-primary
                                             rounded-pill ms-2">
                                    @leaveRequestCount
                                </span>
                            }
                        </button>
                    </li>

                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == Tab.FestivalsHoliday ? "active" : "")"
                                @onclick="() => SetTab(Tab.FestivalsHoliday)">
                            <i class="bi bi-calendar-heart me-2"></i>
                            Festival Holidays
                            @if (festivalCount > 0)
                            {
                                <span class="badge bg-success bg-opacity-10 text-success
                                             rounded-pill ms-2">
                                    @festivalCount
                                </span>
                            }
                        </button>
                    </li>

                </ul>
            </div>
        </div>

        <!-- ══════════ TAB CONTENT ══════════ -->
        <div class="tab-content">

            @if (activeTab == Tab.Leaves)
            {
                <EmployeeLeaveTypes @ref="leaveTab" OnRequestCountChanged="c => { leaveRequestCount = c; StateHasChanged(); }" />
            }

            @* @if (activeTab == Tab.FestivalsHoliday)
            {
                <EmployeeFestivalHolidayTab @ref="festivalTab"
                                            OnCountChanged="c => { festivalCount = c; StateHasChanged(); }" />
            } *@

        </div>
    </div>
}
@code {

    private bool isLoading = true;
    private bool showModal;
    private enum Tab { Leaves, FestivalsHoliday }
    private Tab activeTab = Tab.Leaves;
    private int leaveRequestCount;
    private int festivalCount;

    private string loadingMessage = "Loading leavemanagement... ";
    private EmployeeLeaveTypes? leaveTab;
    // private FestivalHolidayType? festivalTab;
    
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        isLoading = false;
    }

    private void SetTab(Tab tab)
    {
        activeTab = tab;
    }
}
