<button type="@Type"
        class="@ResolvedClass"
        disabled="@Disabled"
        @onclick="OnClick"
        @attributes="FilteredAttributes">
    @if (ChildContent is not null)
    {
        <span class="d-inline-flex align-items-center gap-2">
            @ChildContent

            @if (!string.IsNullOrWhiteSpace(Text))
            {
                <span>@Text</span>
            }
        </span>
    }
    else
    {
        @Text
    }
</button>

@code {
    [Parameter] public string Text { get; set; } = string.Empty;
    [Parameter] public string Type { get; set; } = "button";
    [Parameter] public bool Disabled { get; set; }

    [Parameter] public string DefaultClass { get; set; } = "btn btn-primary";
    [Parameter] public string ButtonClass { get; set; } = "";

    [Parameter] public EventCallback OnClick { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string ResolvedClass
    {
        get
        {
            var finalClass = string.IsNullOrWhiteSpace(ButtonClass)
                ? DefaultClass
                : ButtonClass;

            if (AdditionalAttributes != null &&
                AdditionalAttributes.TryGetValue("class", out var clsObj) &&
                clsObj is string cls &&
                !string.IsNullOrWhiteSpace(cls))
            {
                finalClass = $"{finalClass} {cls}";
            }

            return finalClass;
        }
    }

    private IReadOnlyDictionary<string, object>? FilteredAttributes =>
        AdditionalAttributes?
            .Where(a => a.Key != "class")
            .ToDictionary(a => a.Key, a => a.Value);
}
