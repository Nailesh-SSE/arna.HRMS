@using Microsoft.AspNetCore.Components.Forms
@using System.Linq.Expressions

<div class="mb-1">
    <label class="form-label">
        @Label
        <span class="text-danger">*</span>
    </label>

    <div class="input-group">
        <input class="form-control"
               type="@InputType"
               value="@Value"
               @oninput="OnInput"
               autocomplete="new-password" />

        <AppButton Type="button"
                   ButtonClass="btn btn-outline-secondary"
                   OnClick="ToggleVisibility">
            <i class="bi @(ShowPassword ? "bi-eye-slash" : "bi-eye")"></i>
        </AppButton>
    </div>

    @if (!string.IsNullOrWhiteSpace(Value) && Value != CompareWith)
    {
        <small class="text-danger">Passwords do not match</small>
    }

    @if (ValidationExpression != null)
    {
        <ValidationMessage For="ValidationExpression" />
    }
</div>

@code {
    /* PARAMETERS */
    [Parameter] public string Label { get; set; } = "Confirm Password";

    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string?> ValueChanged { get; set; }

    [Parameter] public string? CompareWith { get; set; }

    [Parameter] public Expression<Func<string?>>? ValidationExpression { get; set; }

    /* INTERNAL */
    private bool ShowPassword;
    private string InputType => ShowPassword ? "text" : "password";

    private async Task OnInput(ChangeEventArgs e)
        => await ValueChanged.InvokeAsync(e.Value?.ToString());

    private void ToggleVisibility()
        => ShowPassword = !ShowPassword;
}
