@using arna.HRMS.ClientServices.Common
@inherits LayoutComponentBase
@inject NotificationService NotificationService

<CascadingValue Value="Collapsed">
    <div class="d-flex min-vh-100 bg-light">

        <!-- Sidebar -->
        <NavMenu OnToggle="ToggleSidebar" />

        <!-- Main Content -->
        <div class="flex-grow-1 d-flex flex-column main-wrapper"
             style="margin-left:@(Collapsed ? "80px" : "264px")">

            <TopBar />

            <!-- 🔥 Toast container INSIDE dashboard -->
            <div class="toast-host">
                <Toasts Messages="NotificationService.Messages"
                        Placement="ToastsPlacement.TopCenter"
                        AutoHide="true"
                        Delay="4000" />
            </div>

            <main class="flex-grow-1 p-4">
                @Body
            </main>
        </div>

    </div>
</CascadingValue>

@code {
    private bool Collapsed;

    protected override void OnInitialized()
    {
        NotificationService.OnChange += StateHasChanged;
    }

    private void ToggleSidebar()
    {
        Collapsed = !Collapsed;
    }

    public void Dispose()
    {
        NotificationService.OnChange -= StateHasChanged;
    }
}
