@inject NavigationManager Nav
@using arna.HRMS.Models.DTOs
@using arna.HRMS.ClientServices.Employee
@inject IEmployeeService EmployeeService

<style>
    .sidebar {
        width: 264px;
        background: linear-gradient(180deg, #0b1d39, #0a1628);
        transition: width .3s ease;
        position: fixed;
        height: 100vh;
        z-index: 1040;
    }

        .sidebar.collapsed {
            width: 80px;
        }

            .sidebar.collapsed .sidebar-text {
                display: none;
            }

    .nav-link {
        height: 44px;
        border-radius: 10px;
        padding: 0 16px;
        display: flex;
        align-items: center;
        gap: 14px;
        color: #e5e7eb;
        font-weight: 500;
    }

        .nav-link:hover {
            background: rgba(255,255,255,.08);
            color: #fff;
        }

        .nav-link.active {
            background: #4f6fe5;
            color: #fff;
            box-shadow: 0 4px 12px rgba(79,111,229,.4);
        }

    /* PERFECT COLLAPSE BUTTON */
    .collapse-btn {
        width: 26px;
        height: 26px;
        border-radius: 50%;
        background: #fff;
        border: 1px solid #e5e7eb;
        position: absolute;
        right: -13px;
        top: 90px;
        box-shadow: 0 4px 12px rgba(0,0,0,.15);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }

        .collapse-btn svg {
            width: 12px;
            height: 12px;
            stroke: #111827;
            stroke-width: 2;
            fill: none;
            transition: transform .2s ease;
        }

    .sidebar.collapsed .collapse-btn svg {
        transform: rotate(180deg);
    }
</style>

<div class="sidebar text-white d-flex flex-column @(Collapsed ? "collapsed" : "")">

    <!-- Logo -->
    <div class="d-flex align-items-center gap-3 p-4 border-bottom border-secondary">
        <div class="bg-primary rounded d-flex align-items-center justify-content-center"
             style="width:36px;height:36px;">
            <i class="bi bi-buildings fs-5"></i>
        </div>
        <span class="fw-bold fs-5 sidebar-text">Arna Technosoft</span>
    </div>

    <!-- Navigation -->
    <nav class="nav flex-column gap-1 px-3 py-3">
        <NavLink href="/" Match="NavLinkMatch.All" class="nav-link" activeClass="active">
            <i class="bi bi-grid fs-5"></i>
            <span class="sidebar-text">Dashboard</span>
        </NavLink>

        <NavLink href="/employee/employeelist" class="nav-link" activeClass="active">
            <i class="bi bi-people fs-5"></i>
            <span class="sidebar-text">Employees</span>
        </NavLink>

        <NavLink href="/attendance" class="nav-link" activeClass="active">
            <i class="bi bi-calendar-check fs-5"></i>
            <span class="sidebar-text">Attendance</span>
        </NavLink>

        <NavLink href="/leave" class="nav-link" activeClass="active">
            <i class="bi bi-calendar2 fs-5"></i>
            <span class="sidebar-text">Leave</span>
        </NavLink>

        <NavLink href="/project" class="nav-link" activeClass="active">
            <i class="bi bi-folder fs-5"></i>
            <span class="sidebar-text">Projects</span>
        </NavLink>

        <NavLink href="/timesheet" class="nav-link" activeClass="active">
            <i class="bi bi-clock fs-5"></i>
            <span class="sidebar-text">Timesheet</span>
        </NavLink>

        <NavLink href="/reports" class="nav-link" activeClass="active">
            <i class="bi bi-bar-chart fs-5"></i>
            <span class="sidebar-text">Reports</span>
        </NavLink>

        <NavLink href="/profile" class="nav-link" activeClass="active">
            <i class="bi bi-person fs-5"></i>
            <span class="sidebar-text">My Profile</span>
        </NavLink>
    </nav>

    <!-- User -->
    <div class="mt-auto p-4 border-top border-secondary">
        <div class="d-flex align-items-center gap-3 mb-3">

            <!-- Avatar -->
            <div class="rounded-circle bg-secondary text-white d-flex
                align-items-center justify-content-center overflow-hidden"
                 style="width:40px;height:40px;">

                @* @if (!string.IsNullOrWhiteSpace(employee?.ProfileImageUrl))
                {
                    <img src="@employee.ProfileImageUrl"
                         alt="Profile"
                         style="width:100%;height:100%;object-fit:cover;" />
                }
                else if (employee != null)
                {
                    <span class="fw-semibold">
                        @employee.FirstName[0]@employee.LastName[0]
                    </span>
                } *@
                <span class="fw-semibold">
                    @EmpF@EmpL
                </span>
            </div>

            <!-- Name + Role -->
            <div class="sidebar-text">
                <div class="fw-semibold">
                    @employee?.FirstName @employee?.LastName
                </div>
                <small class="text-muted">
                    @employee?.Position
                </small>
            </div>
        </div>


        <button class="btn btn-dark w-100 rounded-5">
            <i class="bi bi-box-arrow-right me-2"></i>   
            <span class="sidebar-text">Sign Out</span>
        </button>
    </div>

    <!-- COLLAPSE BUTTON (SVG) -->
    <div class="collapse-btn" @onclick="Toggle" aria-label="Toggle sidebar">
        <svg viewBox="0 0 24 24">
            <polyline points="15 6 9 12 15 18" />
        </svg>
    </div>
</div>

@code {
    private bool Collapsed;
    private EmployeeDto employee=new EmployeeDto();
    private int employeeId = 3;
    private Char EmpF;
    private Char EmpL;

    protected override async Task OnInitializedAsync()
    {
        employee = await EmployeeService.GetEmployeeByIdAsync(employeeId);
        EmpF = employee.FirstName[0];
        EmpL = employee.LastName[0];
    }

    private void Toggle()
    {
        Collapsed = !Collapsed;
    }
}
